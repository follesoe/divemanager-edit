<!DOCTYPE html>
<html>
  <head>
    <title>Suunto DM Editor</title>
    <link rel="stylesheet" href="node_modules/normalize.css/normalize.css">
    <link rel="stylesheet" href="node_modules/SuuntoDMEditorShared/styles/app.css">
    <script src="node_modules/react/dist/JSXTransformer.js"></script>
    <script src="node_modules/react/dist/react.js"></script>
  </head>
  <body>
    <div id="main"></div>
    <input type="file" id="backupFile" nwsaveas="Dive-Manager-Backup.db" />
    <script>
      var dbpath = require('SuuntoDMEditorShared/services/dbpath'),
          fs     = require('fs'),
          gui    = require('nw.gui'),
          win    = gui.Window.get();

      var pathResult = dbpath.getPath();
      var menubar = new gui.Menu({ type: 'menubar' });

      var fileInput = document.querySelector('#backupFile')
      fileInput.addEventListener('change', backup);

      function backup() {
        fs.createReadStream(pathResult.path).pipe(fs.createWriteStream(fileInput.value));
        alert('Database backed up to ' + fileInput.value);
      }

      var file = new gui.Menu();
      file.append(new gui.MenuItem({
        label: 'Open Dive Manager Folder',
        click: function () {
          if (pathResult.exists) {
            gui.Shell.showItemInFolder(pathResult.path);
          } else {
            alert('Suunto Dive Manager not found on computer');
          }
        }
      }));

      file.append(new gui.MenuItem({
        label: 'Backup Dive Manager Database',
        click: function () {
          if (pathResult.exists) {
            fileInput.click();
          } else {
            alert('Suunto Dive Manager not found on computer');
          }
        }
      }));

      menubar.append(new gui.MenuItem({label: 'File', submenu: file}));
      win.menu = menubar;

      require('node-jsx').install({extension: '.js'});
      var app = require('SuuntoDMEditorShared/app');
    </script>
  </body>
</html>
