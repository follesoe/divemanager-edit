<!DOCTYPE html>
<html>
  <head>
    <title>Suunto DM Editor</title>
    <link rel="stylesheet" href="node_modules/normalize.css/normalize.css">
    <link rel="stylesheet" href="styles/app.css">
    <script src="node_modules/react/dist/JSXTransformer.js"></script>
    <script src="node_modules/react/dist/react.js"></script>
  </head>
  <body id="main">

    <!--
    <div class="not-found" ng-hide="fileExists">
      <h2>Suunto Dive Manager not found</h2>
      <p>
        The application could not find Suunto Dive Manager installed on your computer.
      </p>
      <p>
        If you do have it installed this must be a bug. Please submit an issue on the projects
        <a href="http://www.github.com/TODO">github page</a>.
      </p>
    </div>
    -->

    <script type="text/jsx">

      var dbpath = require('./scripts/services/dbpath.js');
      var dbaccess = require('./scripts/services/dbaccess.js');

      var nullDive = {
        StartTime: 'TODO',
        MaxDepth: 0,
        BottomTemperature: 0,
        Duration: 0,
        DiveNumberInSerie: 0,
        Source: 0
      };

      var DiveApp = React.createClass({
        getInitialState: function() {
          return {
            dives: [],
            dbpath: {
              exists: false,
              path: ''
            },
            selectedDive: nullDive
          };
        },
        componentDidMount: function() {
          var pathResult = dbpath.getPath();
          var that = this;
          dbaccess.getDives(pathResult.path).then(function (dives) {
            that.setState({
              dives: dives,
              dbpath: pathResult,
              selectedDive: dives.length > 0 ? dives[0] : nullDive
            });
          });
        },
        render: function() {
          return (
            <div>
              <DiveList data={this.state} />
              <DiveData selectedDive={this.state.selectedDive} />
            </div>
          );
        }
      });

      var DiveList = React.createClass({
        render: function() {
          var diveNodes = this.props.data.dives.map(function (dive) {
            return(
              <li>
                <img src={'images/modes/' + dive.Mode + '.png'} className="mode" />
                <span>{dive.StartDate}</span>
                <span className="light">{dive.Duration} H</span>
                <span className="light">{dive.MaxDepth} M</span>
              </li>
            );
          });

          return (
            <nav>
              <h1>Your Dives</h1>
              <small>{this.props.data.dbpath.path}</small>
              <ul>
                {diveNodes}
              </ul>
            </nav>
          );
        }
      });

      var DiveValue = React.createClass({
        render: function () {
          return (
            <div className="dive-data">
              <h2>{this.props.label}</h2>
              <div>
                <img src={this.props.icon} />
                <h3>{this.props.value}</h3>
                <h4>h</h4>
              </div>
            </div>
          );
        }
      });

      var DiveData = React.createClass({
        render: function () {
          return (
            <section>
              <h1>Selected Dive</h1>
              <h2>Dive Mode</h2>
              <div className="divemodes">
                <label className="divemode">
                  <img src="images/modes/0.png" />
                  <input type="radio" value="0" />
                  <h3>air</h3>
                </label>
                <label className="divemode">
                  <img src="images/modes/1.png" />
                  <input type="radio" value="1" />
                  <h3>ean</h3>
                </label>
                <label className="divemode">
                  <img src="images/modes/2.png" />
                  <input type="radio" value="2" />
                  <h3>gauge</h3>
                </label>
                <label className="divemode">
                  <img src="images/modes/3.png" />
                  <input type="radio" value="3" />
                  <h3>free</h3>
                </label>
              </div>

              <div className="dive-data-fields">
                <DiveValue
                  label="Time In"
                  icon="images/timeicon.png"
                  value={this.props.selectedDive.StartTime} />

                <DiveValue
                  label="Max Depth"
                  icon="images/depthicon.png"
                  value={this.props.selectedDive.MaxDepth} />

                <DiveValue
                  label="Max Depth Temp"
                  icon="images/tempicon.png"
                  value={this.props.selectedDive.BottomTemperature} />

                <DiveValue
                  label="Duration"
                  icon="images/timeicon.png"
                  value={this.props.selectedDive.Duration} />

                <DiveValue
                  label="Dive In Series"
                  icon="images/numbericon.png"
                  value={this.props.selectedDive.DiveNumberInSerie} />

                <DiveValue
                  label="Computer"
                  icon="images/computericon.png"
                  value={this.props.selectedDive.Source} />
              </div>

              <button className="action">Save Changes</button>
            </section>
          );
        }
      });

      React.render(
        <DiveApp />,
        document.getElementById('main')
      );
    </script>

  </body>
</html>
